import{T as h}from"./30h8be0l.js";import{e as T,r as p,R as y,aR as C,f as w,n as g,g as $,j as b,h as i,o as A,w as a,b as o,d as B,ab as I,aQ as R,i as x}from"./CQQOHgVg.js";import{u as N}from"./BUX9gV8r.js";import{u as S}from"./DlAMs9M7.js";import{V as D,a as U,b as z,c as L}from"./DAW_1fs3.js";import{d as M}from"./_7wUQANC.js";import{V as E,a as f}from"./nF_NF1Nb.js";import{V as O,a as j}from"./C-M_vRZd.js";import"./B5CZD0j7.js";import"./DdjJ-Vhj.js";import"./D1dM1BjZ.js";import"./Be4K88FQ.js";import"./BGC9nr2s.js";import"./C5XLPY2q.js";import"./CPSMAnJd.js";const P=()=>h.getInstance(),Q=async()=>{const m=await N(),t=h.getInstance().getTokenByService("graze");return await $fetch(`${m.issuerUri}api/access_check`,{method:"get",headers:{Authorization:`Bearer ${t==null?void 0:t.OAuthToken.AccessToken}`}})},se=T({__name:"admin",async setup(m){let r,t;const s=p(!1),{xs:k}=y(),c=C(),u=P(),d=p(!1),v=()=>{c.global.name.value=c.global.current.value.dark?"light":"dark"};try{[r,t]=w(()=>Q()),r=await r,t(),r&&(d.value=!0)}catch(n){const e=n;(e.message.includes("401")||e.message.includes("403"))&&(u.removeTokensByService("graze"),g(`/admin?error=access_denied&error_description=${encodeURIComponent("You are not authorised to access this service.")}`))}const V=async()=>{const n=x(),e=await S(),l=encodeURIComponent(`${window.location.origin}${n.resolve("/admin").href}`),_=`${e.EndSessionEndpoint}?client_id=internal&post_logout_redirect_uri=${l}`;u.removeTokensByService("graze"),g(_,{external:!0})};return(n,e)=>i(d)?(A(),$(j,{key:0},{default:a(()=>[o(D,{color:"primary","scroll-behavior":"collapse"},{default:a(()=>[o(U,null,{default:a(()=>[...e[2]||(e[2]=[B("Dashboard",-1)])]),_:1}),o(M),o(z,{onClick:e[0]||(e[0]=l=>s.value=!i(s))})]),_:1}),o(L,{modelValue:i(s),"onUpdate:modelValue":e[1]||(e[1]=l=>I(s)?s.value=l:null),location:i(k)?"top":"right",temporary:""},{default:a(()=>[o(E,null,{default:a(()=>[o(f,{"prepend-icon":"mdi:mdi-theme-light-dark",onClick:v,title:`${i(c).global.name.value=="dark"?"Light":"Dark"} Mode`},null,8,["title"]),o(f,{"prepend-icon":"mdi:mdi-logout",onClick:V,title:"Logout"})]),_:1})]),_:1},8,["modelValue","location"]),o(O,null,{default:a(()=>[R(n.$slots,"default")]),_:3})]),_:3})):b("",!0)}});export{se as default};
