import{T as ce}from"./30h8be0l.js";import{u as ve}from"./BUX9gV8r.js";import{f as Pe,j as Ne,m as X,_ as ye,b as _e,d as $e,e as Se,i as Te,k as Ae,V as Me,h as qe,n as Ee}from"./DLuPry4q.js";import{P as He,M as Oe,a2 as Ge,E as Z,r as y,s as je,R as Le,ah as We,p as Ye,k as T,x as Je,a7 as Ke,b as l,a0 as ue,aj as re,a9 as ee,ak as Qe,a as b,F as N,a3 as Ce,al as Xe,U as Ze,aa as et,e as fe,am as te,f as me,g as M,o as S,h as s,ac as tt,w as a,j as Ue,c as le,ad as De,d as w,an as lt,ao as at,t as W,ab as F,n as we}from"./CQQOHgVg.js";import{u as nt,g as it,V as he,a as ke,m as ot,b as ut,h as rt,c as st,i as dt,d as ct,e as se}from"./C8wZl5yh.js";import{V as Y,a as P}from"./hs6exKNd.js";import{V as U}from"./Be4K88FQ.js";import{I as be,d as de}from"./_7wUQANC.js";import{u as vt}from"./BGC9nr2s.js";import{V as ft}from"./R19YWhS6.js";import{V as mt}from"./nF_NF1Nb.js";import"./B5CZD0j7.js";import"./DdjJ-Vhj.js";import"./D1dM1BjZ.js";import"./C5XLPY2q.js";import"./CPSMAnJd.js";const pt=async()=>{const e=await ve(),V=ce.getInstance().getTokenByService("graze");return await $fetch(`${e.issuerUri}api/clients`,{method:"get",headers:{Authorization:`Bearer ${V==null?void 0:V.OAuthToken.AccessToken}`}})},gt=Oe({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxHeight:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...rt(),...ut(),...ot()},"VTextarea"),Vt=He()({name:"VTextarea",directives:{vIntersect:be},inheritAttrs:!1,props:gt(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0,"update:rows":e=>!0},setup(e,h){let{attrs:V,emit:i,slots:f}=h;const m=Ge(e,"modelValue"),{isFocused:C,focus:d,blur:v}=nt(e),{onIntersect:x}=dt(e),u=Z(()=>typeof e.counterValue=="function"?e.counterValue(m.value):(m.value||"").toString().length),_=Z(()=>{if(V.maxlength)return V.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter}),$=y(),o=y(),r=je(""),p=y(),q=y(0),{platform:ae}=Le(),E=it(e),J=Z(()=>e.persistentPlaceholder||C.value||e.active);function K(){var c;E.isSuppressing.value&&E.update(),p.value!==document.activeElement&&((c=p.value)==null||c.focus()),C.value||d()}function g(c){K(),i("click:control",c)}function t(c){i("mousedown:control",c)}function n(c){c.stopPropagation(),K(),ee(()=>{m.value="",et(e["onClick:clear"],c)})}function ne(c){var G;const k=c.target;if(!((G=e.modelModifiers)!=null&&G.trim)){m.value=k.value;return}const A=k.value,O=k.selectionStart,B=k.selectionEnd;m.value=A,ee(()=>{let z=0;A.trimStart().length===k.value.length&&(z=A.length-k.value.length),O!=null&&(k.selectionStart=O-z),B!=null&&(k.selectionEnd=B-z)})}const H=y(),Q=y(Number(e.rows)),ie=Z(()=>["plain","underlined"].includes(e.variant));We(()=>{e.autoGrow||(Q.value=Number(e.rows))});function I(){ee(()=>{if(!p.value)return;if(ae.value.firefox){q.value=12;return}const{offsetWidth:c,clientWidth:k}=p.value;q.value=Math.max(0,c-k)}),e.autoGrow&&ee(()=>{if(!H.value||!o.value)return;const c=getComputedStyle(H.value),k=getComputedStyle(o.value.$el),A=parseFloat(c.getPropertyValue("--v-field-padding-top"))+parseFloat(c.getPropertyValue("--v-input-padding-top"))+parseFloat(c.getPropertyValue("--v-field-padding-bottom")),O=H.value.scrollHeight,B=parseFloat(c.lineHeight),G=Math.max(parseFloat(e.rows)*B+A,parseFloat(k.getPropertyValue("--v-input-control-height"))),z=e.maxHeight?parseFloat(e.maxHeight):parseFloat(e.maxRows)*B+A||1/0,R=Qe(O??0,G,z);Q.value=Math.floor((R-A)/B),r.value=re(R)})}Ye(I),T(m,I),T(()=>e.rows,I),T(()=>e.maxHeight,I),T(()=>e.maxRows,I),T(()=>e.density,I),T(Q,c=>{i("update:rows",c)});let D;return T(H,c=>{c?(D=new ResizeObserver(I),D.observe(H.value)):D==null||D.disconnect()}),Je(()=>{D==null||D.disconnect()}),vt(()=>{const c=!!(f.counter||e.counter||e.counterValue),k=!!(c||f.details),[A,O]=Ke(V),{modelValue:B,...G}=he.filterProps(e),z={...ke.filterProps(e),"onClick:clear":n};return l(he,ue({ref:$,modelValue:m.value,"onUpdate:modelValue":R=>m.value=R,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":ie.value},e.class],style:[{"--v-textarea-max-height":e.maxHeight?re(e.maxHeight):void 0,"--v-textarea-scroll-bar-width":re(q.value)},e.style]},A,G,{centerAffix:Q.value===1&&!ie.value,focused:C.value}),{...f,default:R=>{let{id:j,isDisabled:pe,isDirty:ge,isReadonly:Re,isValid:Fe,hasDetails:Ie}=R;return l(ke,ue({ref:o,style:{"--v-textarea-control-height":r.value},onClick:g,onMousedown:t,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},z,{id:j.value,active:J.value||ge.value,labelId:`${j.value}-label`,centerAffix:Q.value===1&&!ie.value,dirty:ge.value||e.dirty,disabled:pe.value,focused:C.value,details:Ie.value,error:Fe.value===!1}),{...f,default:Be=>{let{props:{class:Ve,...xe},controlRef:ze}=Be;return b(N,null,[e.prefix&&b("span",{class:"v-text-field__prefix"},[e.prefix]),Ce(b("textarea",ue({ref:oe=>p.value=ze.value=oe,class:Ve,value:m.value,onInput:ne,autofocus:e.autofocus,readonly:Re.value,disabled:pe.value,placeholder:e.placeholder,rows:e.rows,name:E.fieldName.value,autocomplete:E.fieldAutocomplete.value,onFocus:K,onBlur:v,"aria-labelledby":`${j.value}-label`},xe,O),null),[[be,{handler:x},null,{once:!0}]]),e.autoGrow&&Ce(b("textarea",{class:Ze([Ve,"v-textarea__sizer"]),id:`${xe.id}-sizer`,"onUpdate:modelValue":oe=>m.value=oe,ref:H,readonly:!0,"aria-hidden":"true"},null),[[Xe,m.value]]),e.suffix&&b("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:k?R=>{var j;return b(N,null,[(j=f.details)==null?void 0:j.call(f,R),c&&b(N,null,[b("span",null,null),l(st,{active:e.persistentCounter||C.value,value:u.value,max:_.value,disabled:e.disabled},f.counter)])])}:void 0})}),Pe({},$,o,p)}}),xt=fe({__name:"EditClientForm",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],async setup(e){let h,V;const i=te(e,"modelValue"),f=([h,V]=me(()=>ve()),h=await h,V(),h),m=y({required:d=>!!d||"Required."}),C=()=>m.value.required(i.value.name)===!0;return i.value.redirect_uri.length===0&&i.value.redirect_uri.push(""),i.value.style||(i.value.style={css:""}),(d,v)=>(S(),M(ct,{onSubmit:tt(C,["stop"]),id:"login-form",action:`${s(f).issuerUri}api/clients`,method:"post"},{default:a(()=>[l(Y,null,{default:a(()=>[l(P,{cols:"12"},{default:a(()=>[l(se,{modelValue:i.value.name,"onUpdate:modelValue":v[0]||(v[0]=x=>i.value.name=x),label:"Name",variant:"outlined",required:"",rules:[m.value.required]},null,8,["modelValue","rules"])]),_:1}),l(P,{cols:"12"},{default:a(()=>[l(se,{modelValue:i.value.description,"onUpdate:modelValue":v[1]||(v[1]=x=>i.value.description=x),label:"Description",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),l(Y,null,{default:a(()=>[l(P,{cols:"12"},{default:a(()=>[(S(!0),le(N,null,De(i.value.redirect_uri,(x,u)=>(S(),M(se,{modelValue:i.value.redirect_uri[u],"onUpdate:modelValue":_=>i.value.redirect_uri[u]=_,label:"Redirect URL",variant:"outlined","append-icon":"mdi:mdi-window-close","onClick:append":_=>i.value.redirect_uri.length>1?i.value.redirect_uri.splice(u,1):""},null,8,["modelValue","onUpdate:modelValue","onClick:append"]))),256))]),_:1})]),_:1}),l(Y,null,{default:a(()=>[l(P,null,{default:a(()=>[l(U,{onClick:v[2]||(v[2]=x=>i.value.redirect_uri.push("")),"prepend-icon":"mdi:mdi-plus",color:"primary"},{default:a(()=>[...v[4]||(v[4]=[w(" Add URI ",-1)])]),_:1})]),_:1})]),_:1}),i.value.style?(S(),M(Y,{key:0},{default:a(()=>[l(P,null,{default:a(()=>[l(Vt,{modelValue:i.value.style.css,"onUpdate:modelValue":v[3]||(v[3]=x=>i.value.style.css=x),label:"CSS",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})):Ue("",!0)]),_:1},8,["action"]))}}),L="00000000-0000-0000-0000-000000000000",yt=fe({__name:"ClientDialog",props:{modelValue:{required:!1},modelModifiers:{},clients:{required:!0},clientsModifiers:{},"request-delete":{type:Boolean,required:!1},"request-deleteModifiers":{}},emits:lt(["error","secret"],["update:modelValue","update:clients","update:request-delete"]),async setup(e,{emit:h}){let V,i;const f=h,m=([V,i]=me(()=>ve()),V=await V,i(),V),C=ce.getInstance(),d=te(e,"modelValue"),v=te(e,"clients"),x=te(e,"request-delete"),u=y(),_=y(!!d.value),$=y(),o=y(""),r=y(!1),p=y(!1);T(d,()=>{var g,t;$.value=void 0,d&&(u.value=X.cloneDeep(d.value),(g=u.value)!=null&&g.client_uuid&&((t=u.value)==null?void 0:t.client_uuid)!==L&&($.value=()=>{p.value=!0})),_.value=!!d.value}),T(x,()=>{x.value&&(p.value=!0)}),T(p,()=>{p.value||(x.value=!1)});const q=(g,t=!1)=>{if(!g)return;const n=v.value.findIndex(ne=>ne.client_uuid==g.client_uuid);n>=0?t?v.value.splice(n,1):v.value.splice(n,1,X.cloneDeep(g)):v.value.push(X.cloneDeep(g))},ae=async g=>{if(!d.value)return;const t=C.getTokenByService("graze");if(d.value.client_uuid&&d.value.client_uuid!==L)try{await $fetch(`${m.issuerUri}api/client/${d.value.client_uuid}`,{method:"put",headers:{Authorization:`Bearer ${t==null?void 0:t.OAuthToken.AccessToken}`},body:{Client:u.value}})||f("error","Unexpected error encountered when updating client")}catch(n){f("error",`Error encountered when updating client: ${n}`)}else try{const n=await $fetch(`${m.issuerUri}api/clients`,{method:"post",headers:{Authorization:`Bearer ${t==null?void 0:t.OAuthToken.AccessToken}`},body:{Client:u.value}});u.value=n.Client,q(u.value),r.value=!0,o.value=n.Secret}catch(n){f("error",`Error encountered when removing client: ${n}`)}d.value=void 0},E=async()=>{if(!d.value||!d.value.client_uuid)return;const g=C.getTokenByService("graze");try{await $fetch(`${m.issuerUri}api/client/${d.value.client_uuid}`,{method:"delete",headers:{Authorization:`Bearer ${g==null?void 0:g.OAuthToken.AccessToken}`}})&&q(d.value,!0)}catch(t){f("error",`Error encountered when removing client: ${t}`)}d.value=void 0},J=async()=>{try{navigator.clipboard&&await navigator.clipboard.writeText(o.value)}catch(g){console.error(g.message)}},K=async({callback:g})=>{const t=C.getTokenByService("graze");try{if(!d.value)return;const n=await $fetch(`${m.issuerUri}api/client/${d.value.client_uuid}/secret`,{method:"get",headers:{Authorization:`Bearer ${t==null?void 0:t.OAuthToken.AccessToken}`}});n&&(r.value=!0,o.value=n.Secret)}catch(n){f("error",`Error encountered when removing client: ${n}`)}await g()};return(g,t)=>(S(),le(N,null,[l(ye,{modelValue:s(_),"onUpdate:modelValue":t[1]||(t[1]=n=>F(_)?_.value=n:null),onClose:t[2]||(t[2]=n=>d.value=void 0),onReset:t[3]||(t[3]=n=>u.value=s(X.cloneDeep)(d.value)),onSave:ae,onDelete:s($),"hide-extension":!0,"show-save-action":!0,"show-reset-action":!0,"show-close-action":!0,"close-action-label":s(u)&&s(u).client_uuid&&s(u).client_uuid!==s(L)?"Close":"Cancel"},at({default:a(()=>[s(u)?(S(),M(xt,{key:0,modelValue:s(u),"onUpdate:modelValue":t[0]||(t[0]=n=>F(u)?u.value=n:null)},null,8,["modelValue"])):Ue("",!0)]),_:2},[s(u)?{name:"title",fn:a(()=>{var n;return[w(W(`${s(u).client_uuid&&s(u).client_uuid!==s(L)?`Edit: ${(n=s(u))==null?void 0:n.name}`:"Create Client"}`),1)]}),key:"0"}:void 0,s(u)&&s(u).client_uuid&&s(u).client_uuid!==s(L)?{name:"actions",fn:a(()=>[l(Ne,{color:"red-darken-1",variant:"text",onClick:K},{default:a(()=>[...t[11]||(t[11]=[w(" Regenerate Secret ",-1)])]),_:1})]),key:"1"}:void 0]),1032,["modelValue","onDelete","close-action-label"]),l(ye,{modelValue:s(r),"onUpdate:modelValue":t[4]||(t[4]=n=>F(r)?r.value=n:null),"show-close-action":!0,"close-action-label":"Close","hide-extension":!0,title:"New Client Secret",onClose:t[5]||(t[5]=n=>{r.value=!1,o.value=""}),onSave:t[6]||(t[6]=n=>{J(),r.value=!1,o.value=""})},{default:a(()=>[t[12]||(t[12]=b("p",{class:"mb-4"}," The following secret was generated, it will not be displayed again: ",-1)),b("p",null,[b("span",{onClick:J,class:"cursor-pointer"},W(s(o)),1),l(U,{"append-icon":"mdi:mdi-clipboard-outline",size:"medium",variant:"text",class:"ml-3",onClick:J})])]),_:1},8,["modelValue"]),l(Me,{modelValue:s(p),"onUpdate:modelValue":t[10]||(t[10]=n=>F(p)?p.value=n:null)},{default:a(()=>[l(_e,{color:"error"},{default:a(()=>[l($e,null,{default:a(()=>[l(Se,{class:"d-flex"},{default:a(()=>[t[13]||(t[13]=w(" Confirmation Required ",-1)),l(de),l(U,{icon:"mdi:mdi-close",size:"x-small",variant:"text",onClick:t[7]||(t[7]=n=>p.value=!1)})]),_:1})]),_:1}),l(Te,null,{default:a(()=>[...t[14]||(t[14]=[b("p",{class:"mb-4"},"Are you sure you wish to delete this client?",-1),b("p",null,"Any services logging in with this client identity and secret will cease to function.",-1)])]),_:1}),l(Ae,null,{default:a(()=>[l(U,{onClick:t[8]||(t[8]=n=>p.value=!1)},{default:a(()=>[...t[15]||(t[15]=[w(" Close Dialog ",-1)])]),_:1}),l(de),l(U,{onClick:t[9]||(t[9]=n=>{p.value=!1,E()})},{default:a(()=>[...t[16]||(t[16]=[w(" Delete ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}}),zt=fe({__name:"dashboard",async setup(e){let h,V;const i=y(),f=y(!1),m=y(""),C=ce.getInstance(),d=C.getTokenByService("graze");(!d||C.accessTimeRemaining(d)<=0)&&we("/admin");const v=y([]),x=y(!1);try{v.value=([h,V]=me(()=>pt()),h=await h,V(),h)}catch($){$.message.includes("403")&&(C.removeTokensByService("graze"),we(`/admin?error=access_denied&error_description=${encodeURIComponent("You are not authorised to access this service.")}`))}const u=()=>({id:0,client_uuid:L,name:"",description:"",secret:"",redirect_uri:[""],style:{}}),_=$=>{m.value=$,f.value=!0};return($,o)=>(S(),M(ft,null,{default:a(()=>[l(Y,null,{default:a(()=>[l(P,null,{default:a(()=>[(S(!0),le(N,null,De(s(v),r=>(S(),M(_e,{color:"grey-lighten-3",variant:"elevated",elevation:"16"},{default:a(()=>[l($e,null,{default:a(()=>[l(Se,null,{default:a(()=>[w(W(r.name),1)]),_:2},1024),l(qe,null,{default:a(()=>[w(W(r.description),1)]),_:2},1024)]),_:2},1024),l(Te,null,{default:a(()=>[w(" RedirectURI"+W(r.redirect_uri&&r.redirect_uri.length>1?"s":"")+": ",1),r.redirect_uri&&r.redirect_uri.length>0?(S(),M(mt,{key:0,items:r.redirect_uri,density:"compact","bg-color":"transparent",class:"text-medium-emphasis"},null,8,["items"])):(S(),le(N,{key:1},[w(" Unset ")],64))]),_:2},1024),l(Ae,null,{default:a(()=>[l(U,{color:"error","prepend-icon":"mdi:mdi-delete",variant:"elevated",onClick:p=>{i.value=r,x.value=!0}},{default:a(()=>[...o[6]||(o[6]=[w(" Delete ",-1)])]),_:1},8,["onClick"]),l(de),l(U,{color:"primary","prepend-icon":"mdi:mdi-pencil",variant:"elevated",onClick:p=>i.value=r},{default:a(()=>[...o[7]||(o[7]=[w(" Edit ",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024))),256))]),_:1})]),_:1}),l(Y,null,{default:a(()=>[l(P,{class:"text-right"},{default:a(()=>[l(U,{"prepend-icon":"mdi:mdi-plus",color:"primary",onClick:o[0]||(o[0]=r=>i.value=u())},{default:a(()=>[...o[8]||(o[8]=[w(" Add Client ",-1)])]),_:1})]),_:1})]),_:1}),l(yt,{modelValue:s(i),"onUpdate:modelValue":o[1]||(o[1]=r=>F(i)?i.value=r:null),clients:s(v),"onUpdate:clients":o[2]||(o[2]=r=>F(v)?v.value=r:null),requestDelete:s(x),"onUpdate:requestDelete":o[3]||(o[3]=r=>F(x)?x.value=r:null),onError:_},null,8,["modelValue","clients","requestDelete"]),l(Ee,{modelValue:s(f),"onUpdate:modelValue":o[5]||(o[5]=r=>F(f)?f.value=r:null),timeout:5e3,"multi-line":""},{actions:a(()=>[l(U,{color:"white",variant:"text",onClick:o[4]||(o[4]=r=>f.value=!1)},{default:a(()=>[...o[9]||(o[9]=[w(" Close ",-1)])]),_:1})]),default:a(()=>[w(W(s(m))+" ",1)]),_:1},8,["modelValue"])]),_:1}))}});export{zt as default};
