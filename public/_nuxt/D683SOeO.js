import{_ as E}from"./DHZQMoza.js";import{u as b,L as g,_ as q}from"./jwHjlgTM.js";import{u as U}from"./XyDiHmpY.js";import{u as P}from"./B-pYYkJ6.js";import{e as A,i as $,r as x,f as _,k as z,c as I,o as r,g as u,j as i,w as e,b as t,l as F,n as S,a as G,t as M,h as B,F as J,d as K}from"./CQQOHgVg.js";import{V as c,a as f}from"./hs6exKNd.js";import{u as N}from"./BUX9gV8r.js";import{u as O}from"./BhWtroNR.js";import{V as D}from"./R19YWhS6.js";import{V as j}from"./Be4K88FQ.js";import"./C8wZl5yh.js";import"./BGC9nr2s.js";import"./DLuPry4q.js";import"./_7wUQANC.js";import"./D1dM1BjZ.js";import"./DgX9QmaX.js";import"./GrYp5ZhT.js";import"./DdjJ-Vhj.js";import"./B5CZD0j7.js";const H=A({__name:"LoginButtons",props:{showAmazonLogin:{type:Boolean,default:!1},showEmailLogin:{type:Boolean,default:!1},showFaceBookLogin:{type:Boolean,default:!1},showGoogleLogin:{type:Boolean,default:!1},showInstagramLogin:{type:Boolean,default:!1},showKeycloakLogin:{type:Boolean,default:!1},showMicrosoftLogin:{type:Boolean,default:!1},showSteamLogin:{type:Boolean,default:!1},showTelegramLogin:{type:Boolean,default:!1},showTwitchLogin:{type:Boolean,default:!1},showTwitterLogin:{type:Boolean,default:!1}},emits:["login"],async setup(a,{emit:w}){let o,m;const{addState:T}=P(),p=U(),v=$(),d=x();try{d.value=([o,m]=_(()=>b(`${window.location.origin}${v.resolve("/connect/external").href}`)),o=await o,m(),o)}catch(k){console.error(k)}const h=w,s=x("");return z(s,()=>{var R;const k=(R=d.value)==null?void 0:R.get(s.value);if(!k){h("login",{method:s.value});return}const l=new URL(k).searchParams.get("state");l&&T(l,p),h("login",{method:s.value,uri:k})}),(k,n)=>(r(),I("div",null,[a.showEmailLogin?(r(),u(c,{key:0,dense:!0},{default:e(()=>[t(f,null,{default:e(()=>[t(g,{source:"internal",onClick:n[0]||(n[0]=l=>s.value="internal")})]),_:1})]),_:1})):i("",!0),a.showAmazonLogin?(r(),u(c,{key:1,dense:!0},{default:e(()=>[t(f,null,{default:e(()=>[t(g,{source:"amazon",onClick:n[1]||(n[1]=l=>s.value="amazon")})]),_:1})]),_:1})):i("",!0),a.showFaceBookLogin?(r(),u(c,{key:2,dense:!0},{default:e(()=>[t(f,null,{default:e(()=>[t(g,{source:"facebook",onClick:n[2]||(n[2]=l=>s.value="facebook")})]),_:1})]),_:1})):i("",!0),a.showGoogleLogin?(r(),u(c,{key:3,dense:!0},{default:e(()=>[t(f,null,{default:e(()=>[t(g,{source:"google",onClick:n[3]||(n[3]=l=>s.value="google")})]),_:1})]),_:1})):i("",!0),a.showInstagramLogin?(r(),u(c,{key:4,dense:!0},{default:e(()=>[t(f,null,{default:e(()=>[t(g,{source:"instagram",onClick:n[4]||(n[4]=l=>s.value="instagram")})]),_:1})]),_:1})):i("",!0),a.showMicrosoftLogin?(r(),u(c,{key:5,dense:!0},{default:e(()=>[t(f,null,{default:e(()=>[t(g,{source:"microsoft",onClick:n[5]||(n[5]=l=>s.value="microsoft")})]),_:1})]),_:1})):i("",!0),a.showSteamLogin?(r(),u(c,{key:6,dense:!0},{default:e(()=>[t(f,null,{default:e(()=>[t(g,{source:"steam",onClick:n[6]||(n[6]=l=>s.value="steam")})]),_:1})]),_:1})):i("",!0),a.showTelegramLogin?(r(),u(c,{key:7,dense:!0},{default:e(()=>[t(f,null,{default:e(()=>[t(g,{source:"telegram"})]),_:1})]),_:1})):i("",!0),a.showTwitchLogin?(r(),u(c,{key:8,dense:!0},{default:e(()=>[t(f,null,{default:e(()=>[t(g,{source:"twitch",onClick:n[7]||(n[7]=l=>s.value="twitch")})]),_:1})]),_:1})):i("",!0),a.showTwitterLogin?(r(),u(c,{key:9,dense:!0},{default:e(()=>[t(f,null,{default:e(()=>[t(g,{source:"twitter",onClick:n[8]||(n[8]=l=>s.value="twitter")})]),_:1})]),_:1})):i("",!0),a.showKeycloakLogin?(r(),u(c,{key:10,dense:!0},{default:e(()=>[t(f,null,{default:e(()=>[t(g,{source:"keycloak",onClick:n[9]||(n[9]=l=>s.value="keycloak")})]),_:1})]),_:1})):i("",!0)]))}}),Q=()=>{try{const a=$(),w=a.currentRoute.value.query.state||"",o=new URL(a.currentRoute.value.query.redirect_uri||"");return o.searchParams.set("state",w),o.toString()}catch(a){console.error(a)}return""},W=async a=>{const w=await N();try{return await $fetch(`${w.issuerUri}connect/style/${a}`,{method:"get",parseResponse:o=>{try{return JSON.parse(o)}catch{throw o}}})}catch{return{}}},X=async a=>{const w=await N(),{getAccessToken:o,storeAccessToken:m,storeRefreshToken:T}=O();let p="";try{p=await o()}catch{throw new Error("no access token available")}try{return await $fetch(`${w.issuerUri}connect/auth/token`,{method:"post",body:JSON.stringify({oauth:a,access_token:p,new:!1}),parseResponse:v=>{const d=JSON.parse(v);return d.AccessToken&&m(d.AccessToken),d.RefreshToken&&T(d.RefreshToken),{RedirectURI:d.RedirectURI||"",Existing:d.Existing||!1}}})}catch(v){throw v}},Y={class:"text-center"},Le=A({__name:"auth",emits:["pageTitle"],async setup(a,{emit:w}){let o,m;const T=([o,m]=_(()=>N()),o=await o,m(),o),{getAccessToken:p}=O();w("pageTitle","Login");const d=Q(),h=x("BUTTONS"),s=async()=>{try{if(F().query.state){const y=U(),C=await X(y);C&&(new URL(C).searchParams.get("error")||S(C,{external:!0}))}}catch{}};let k;try{k=([o,m]=_(()=>p()),o=await o,m(),o),k&&s()}catch{}const n=({method:L,uri:y})=>{switch(L){case"internal":h.value="INTERNAL_LOGIN";break;case"keycloak":S(y,{external:!0});break}},l=$(),R=([o,m]=_(()=>W(l.currentRoute.value.query.client_id)),o=await o,m(),o);if(R){const L=document.createElement("style");L.textContent=R.css,document.head.append(L)}return(L,y)=>{const C=E;return r(),u(D,null,{default:e(()=>[G("h1",Y,M(B(T).organisationName),1),B(h)=="BUTTONS"?(r(),I(J,{key:0},[t(H,{showEmailLogin:!0,showKeycloakLogin:!0,showTelegramLogin:!0,onLogin:n,style:{"max-width":"250px"},class:"ma-auto mb-5"}),t(c,null,{default:e(()=>[t(f,{class:"pa-0 text-center"},{default:e(()=>[t(C,{href:B(d)},{default:e(()=>[t(j,{variant:"text"},{default:e(()=>[...y[1]||(y[1]=[K(" Cancel ",-1)])]),_:1})]),_:1},8,["href"])]),_:1})]),_:1})],64)):B(h)=="INTERNAL_LOGIN"?(r(),u(q,{key:1,onCancel:y[0]||(y[0]=V=>h.value="BUTTONS")})):i("",!0)]),_:1})}}});export{Le as default};
